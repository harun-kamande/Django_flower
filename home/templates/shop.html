{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Flower Delivery Service</title>
    <link rel="stylesheet" href="{% static 'css/shop.css' %}">
</head>
<body>
    <header>
        <div class="logo">
            <img src="{% static 'images/Group-6-modified.png' %}" alt="Flower Delivery Logo">
            <h1>Flower Delivery</h1>
        </div>
        <nav>
            <ul>
                <li><a href="{% url 'home' %}">Home</a></li>
                <li><a href="{% url 'shop' %}">Shop</a></li>
                <li><a href="{% url 'cart' %}">Cart</a></li>
            </ul>
        </nav>
    </header>

    <section class="shop-hero">
        <h2>Shop Our Collection</h2>
        <p>Browse our variety of beautiful flowers available for delivery.</p>
    </section>

    <section class="product-list">
        {% if flowers %}
        {{flower}}
{% for flower in flowers %}
    <div class="product-card">
        <img src="{{ flower.image.url }}" alt="Bouquet of {{ flower.name }}">
        <h3>{{ flower.name }}</h3>
        <p>Beautiful {{ flower.name }} to brighten your day.</p>
        <p class="price">KSH {{ flower.price|floatformat:2 }}/=</p>
        <button onclick="addToCart({{ flower.id }}, '{{ flower.name }}', {{ flower.price }})">Add to Cart</button>
    </div>
{% endfor %}

        {% else %}
            <p>No products available at the moment.</p>
        {% endif %}
    </section>

    <section id="cart-display">
        <!-- Cart details will be dynamically inserted here -->
    </section>

    <footer>
        <p>Flower Delivery. Award-winning blooms, delivered with elegance..</p>
    </footer>

    <script>
    // Add item to cart
    function addToCart(productId, productName, productPrice) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // Check if product exists in cart (by ID, not name)
        let existingItem = cart.find(item => item.id === productId);

        if (existingItem) {
            existingItem.quantity += 1;
            existingItem.totalPrice = existingItem.quantity * existingItem.price;
        } else {
            cart.push({
                id: productId,
                name: productName,
                price: productPrice,
                quantity: 1,
                totalPrice: productPrice
            });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        displayCart();

        alert(`${productName} added to your cart!`);
    }

    // Display cart
    function displayCart() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let cartDetails = "";
        let grandTotal = 0;

        cart.forEach(item => {
            cartDetails += `
                <p>
                    ${item.name} - ${item.quantity} x KSH ${item.price}/= = KSH ${item.totalPrice}/=
                </p>`;
            grandTotal += item.totalPrice;
        });

        cartDetails += `<p><strong>Total Amount: KSH ${grandTotal}/=</strong></p>`;
        document.getElementById('cart-display').innerHTML = cartDetails;
    }

    document.addEventListener("DOMContentLoaded", displayCart);
</script>

</body>
</html>
